@using PikaCore.Security
@using PikaCore.Areas.Core.Controllers.Helpers
@model Tuple<string, Microsoft.Extensions.FileProviders.IFileInfo>
@inject IdDataProtection DataProtection

@{
    var item = Model.Item2;
    var viewableName = item.Name.StartsWith("~")
        ? item.Name.Replace("~", "")
        : item.Name;
}
@{
    var mime = "";
    mime = MimeAssistant.GetMimeType(item.PhysicalPath);
    if (!mime.StartsWith("image/")
        && !mime.StartsWith("video/"))
    {
        var type = MimeAssistant.RecognizeIconByMime(mime);
        <div class="row collection-item">
            <div class="col s1 m1 l1 center center-align">
                <i class="fas fa-@type prefix browse-icon-margin">
                </i>
            </div>
            <div class="col s11 m11 l11">
                <a class="browse-collection-item" 
                   asp-area="Core"
                   asp-controller="Storage"
                   asp-action="Download"
                   asp-route-id=@DataProtection.Encode(item.PhysicalPath)
                   asp-route-returnUrl=@Model.Item1 title="@viewableName">

                    @viewableName
                    @if (item.Name.StartsWith("~"))
                    {
                        <span class="material-icons">
                            lock
                        </span>
                    }
                </a>
            </div>
        </div>
    }
    else
    {
        var id = "1." + Model.Item1?.Replace("/", "-") + $"-{item.Name}";
        <div class="col s3 m1 l1 material-placeholder">
            <img class="materialboxed" id="@id" alt="@item.Name" width="48" src="~/images/loading_icon.gif"/>
        </div>
        <div class="col s5 m7 l7 center-align">
            <a class="browse-collection-item" 
               asp-area="Core"
               asp-controller="Storage"
               asp-action="Download"
               asp-route-returnUrl="@Model.Item1"
               asp-route-id=@DataProtection.Encode(item.PhysicalPath)
               title="@item.Name">
                @viewableName
                @if (item.Name.StartsWith("~"))
                {
                    <span class="material-icons">
                        lock
                    </span>
                }
            </a>
        </div>
    }

}