@model PikaCore.Models.ManageViewModels.AdminPanelViewModel

@{
    ViewData["Title"] = "Register - Admin";
    var msg = ViewData["returnMessage"];
}

<h2>@ViewData["Title"]</h2>

@await Html.PartialAsync("_StatusMessage", msg)

<ul class="nav nav-tabs item-border">
    <li class="nav-item item-border active">
        <a class="nav-link teal-text" href="#" onclick="changeVisibleTab(document.activeElement);">Users table</a>
    </li>
    <li class="nav-item item-border">
        <a class="nav-link teal-text" href="#" onclick="changeVisibleTab(document.activeElement);">Logs</a>
    </li>
</ul>

<div id="container">
    <div class="row" style="padding-top: 10px; padding-bottom: 10px; font-weight: bold;">
        <div class="col s5">
            Username
        </div>
        <div class="col s3">
            Permission level
        </div>
        <div class="col s4">
            Options
        </div>
    </div>
    <div class="div-table">
        @foreach (var (key, value) in Model.UsersWithRoles)
        {
            var roleString = "";
            value.ToList().ForEach(role =>
            {
                roleString = string.Concat(roleString, " ", role);
            });
                
            <div class="row">
                <div class="col s5 truncate">
                    @Html.DisplayFor(modelItem => key.UserName)
                </div>
                <div class="col s3">
                
                @Html.DisplayFor(modelItem => roleString)
                </div>
                    <div class="col s4">
                        <a class="teal-text" asp-action="Edit" asp-controller="Manage" asp-route-id=@key.Id><i class="fas fa-pen"></i></a>
                        <a class="teal-text" asp-action="Delete" asp-controller="Manage" asp-route-id="@key.Id"><i class="fas fa-trash-alt"></i></a>
                        <a class="teal-text" asp-action="GeneratePassword" asp-controller="Manage" asp-route-id="@key.Id"><i class="fas fa-key"></i></a>
                    </div>
            </div>
        }     
    </div>
    <div id="downloadPartialDiv">
        @await Html.PartialAsync("/Views/Manage/Admin/_GeneratePasswordViewPartial.cshtml")
    </div>
    <div id="logs" hidden>
        @await Html.PartialAsync("/Views/Manage/Admin/_LogsViewPartial.cshtml", Model.LogsListViewModel)
    </div>
</div>

@section Scripts {
    @await Html.PartialAsync("_ValidationScriptsPartial")
}
