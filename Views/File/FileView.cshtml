@model FMS2.Models.FileResultModel
@using System.IO
@using Microsoft.Extensions.FileProviders

@{
    ViewData["Title"] = "Browse";
    object lastPath = ViewData["path"];
    var id = 0;
    var msg = TempData["returnMessage"];
    var parent = ViewData["parent"]; 
}
<h3>
    Directory listing for:<a href="/File?path=/">Index</a>
    @{
        string[] splitted = lastPath.ToString().Split("/");
        string last = "";
        foreach (string part in splitted)
        {
            if (!part.Equals("/") && !String.IsNullOrEmpty(part))
            {
                last = String.Concat(last, "/", part);
                <label>/</label>
            }

            <a href="/File?path=@last" class="path-button">@part</a>
        }
    }
</h3>
        @if(msg != null)
        {
            <div class="input-group">
                <p>@msg.ToString()</p>
                <span class="input-group-addon" aria-hidden="true"><span class="glyphicon glyphicon-warning-sign text-danger"></span></span>
            </div>
        }

        <div id="download-panel" class="row" hidden>
            <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
            </div>
            <form asp-action="CancelDownloadAsync" asp-controller="File" method="post">
              <div class="form-group">
                <button type="cancel" class="btn btn-default" data-dismiss="modal">Cancel</button>
              </div>
            </form>
        </div>

        <div class ="row" style="font-size:14px;">
            <a asp-controller="File" asp-action="Index" asp-route-path=@parent><strong>Back</strong></a>
        </div>
        <div class="row">
            <label label-for="searchBox">Search list:</label>
            <input id="searchBox" type="text" oninput="searchFileList();"/>
        </div>
        <div class="row" style="padding-top: 10px; padding-bottom: 10px; font-weight: bold;">
            <div class ="col-md-3">
                Name
            </div>
            <div class ="col-md-3">
                Type
            </div>
            <div class ="col-md-3">
                Size
            </div>
            <div class ="col-md-3">
                Options
            </div>
        </div>
<div id="file-list" class="table-div">
    @if (Model.Contents != null)
    {
        foreach (var item in Model.Contents)
        {
             <div class="row">
                 <div class="col-md-3 truncate">
                     @if (item.IsDirectory)
                     {
                         <a asp-controller="File" asp-action="Index" asp-route-path=@item.Name>@item.Name</a>
                     }
                     else
                     {
                         <a asp-controller="File" asp-action="Download" asp-route-id=@id>@item.Name</a>
                     }
                 </div>
                 <div class="col-md-3">
                     @(@File.Exists(@item.PhysicalPath) ? "File" : "Directory")
                 </div>
                 <div class="col-md-3">
                     @if (!item.IsDirectory)
                     {
                         long i = @item.Length / (1000 * 1000);
                         <p>@i MB</p>
                     }
                     else
                     {
                         <p>---</p>
                     }
                 </div>
                 <div class="col-md-3">
                     @if (!item.IsDirectory)
                     {
                         @Html.ActionLink("Generate download url", "GenerateUrlView", new { @entryName = item.PhysicalPath })
                     }
                     @if (item.Name.EndsWith(".mp3") || item.Name.EndsWith(".mp4"))
                     {
                         TempData["src"] = id;
                         @Html.ActionLink("Play", "Video", "Video")
                     }

                 </div>
             </div>
            id++;
             <hr>
        }
    }
    else
    {
       <div class="input-group">
           <p>@msg.ToString()</p>
           <span class="input-group-addon" aria-hidden="true"><span class="glyphicon glyphicon-warning-sign text-danger"></span></span>
       </div>
    }
</div>
        <div class ="row" style="font-size:14px;">
            <a asp-controller="File" asp-action="Index" asp-route-path=@parent><strong>Back</strong></a>
        </div>
<script>
    document.getElementById("searchBox").addEventListener("keydown", function(e){
        if(e.keyCode == 8){
            searchFileList();
        }
    });
</script>
